// SPDX-License-Identifier: GPL-2.0
/*
 * Copyright (C) 2021 PHYTEC America, LLC - https://www.phytec.com
 * Author: Matt McKee <mmckee@phytec.com>
 *
 * Copyright (C) 2022 PHYTEC Messtechnik GmbH
 * Author: Wadim Egorov <w.egorov@phytec.de>
 *
 * Product homepage:
 * https://www.phytec.com/product/phyboard-am64x
 */

/dts-v1/;

#include <dt-bindings/gpio/gpio.h>
#include <dt-bindings/input/input.h>
#include <dt-bindings/leds/common.h>
#include <dt-bindings/leds/leds-pca9532.h>
#include <dt-bindings/mux/ti-serdes.h>
#include <dt-bindings/phy/phy.h>
#include "k3-am642.dtsi"
#include "k3-am64-phycore-som.dtsi"

/ {
	compatible = "phytec,am642-phyboard-electra-rdk",
		     "phytec,am64-phycore-som", "ti,am642";
	model = "PHYTEC phyBOARD-Electra-AM64x RDK";

	aliases {
		ethernet1 = &icssg0_emac0;
		ethernet2 = &icssg0_emac1;
		mmc1 = &sdhci1;
		serial2 = &main_uart0;
		serial3 = &main_uart1;
	};

	chosen {
		stdout-path = &main_uart0;
	};

	can_tc1: can-phy0 {
		compatible = "ti,tcan1042";
		pinctrl-names = "default";
		pinctrl-0 = <&can_tc1_pins_default>;
		#phy-cells = <0>;
		max-bitrate = <8000000>;
		standby-gpios = <&main_gpio0 32 GPIO_ACTIVE_HIGH>;
	};

	can_tc2: can-phy1 {
		compatible = "ti,tcan1042";
		pinctrl-names = "default";
		pinctrl-0 = <&can_tc2_pins_default>;
		#phy-cells = <0>;
		max-bitrate = <8000000>;
		standby-gpios = <&main_gpio0 35 GPIO_ACTIVE_HIGH>;
	};


	/* Dual Ethernet application node on PRU-ICSSG0 */
	icssg0_eth: icssg0-eth {
		compatible = "ti,am642-icssg-prueth";
		pinctrl-names = "default";
		pinctrl-0 = <&icssg0_rgmii1_pins_default &icssg0_rgmii2_pins_default>;

		sram = <&oc_sram>;
		ti,prus = <&pru0_0>, <&rtu0_0>, <&tx_pru0_0>, <&pru0_1>, <&rtu0_1>, <&tx_pru0_1>;
		firmware-name = "ti-pruss/am65x-sr2-pru0-prueth-fw.elf",
				"ti-pruss/am65x-sr2-rtu0-prueth-fw.elf",
				"ti-pruss/am65x-sr2-txpru0-prueth-fw.elf",
				"ti-pruss/am65x-sr2-pru1-prueth-fw.elf",
				"ti-pruss/am65x-sr2-rtu1-prueth-fw.elf",
				"ti-pruss/am65x-sr2-txpru1-prueth-fw.elf";

		ti,pruss-gp-mux-sel = <2>,	/* MII mode */
				      <2>,
				      <2>,
				      <2>,	/* MII mode */
				      <2>,
				      <2>;

		ti,mii-g-rt = <&icssg0_mii_g_rt>;
		ti,mii-rt = <&icssg0_mii_rt>;
		ti,pa-stats = <&icssg0_pa_stats>;
		iep = <&icssg0_iep0>, <&icssg0_iep1>;

		interrupt-parent = <&icssg0_intc>;
		interrupts = <24 0 2>, <25 1 3>;
		interrupt-names = "tx_ts0", "tx_ts1";

		dmas = <&main_pktdma 0xc100 0>, /* egress slice 0 */
		       <&main_pktdma 0xc101 0>, /* egress slice 0 */
		       <&main_pktdma 0xc102 0>, /* egress slice 0 */
		       <&main_pktdma 0xc103 0>, /* egress slice 0 */
		       <&main_pktdma 0xc104 0>, /* egress slice 1 */
		       <&main_pktdma 0xc105 0>, /* egress slice 1 */
		       <&main_pktdma 0xc106 0>, /* egress slice 1 */
		       <&main_pktdma 0xc107 0>, /* egress slice 1 */
		       <&main_pktdma 0x4100 0>, /* ingress slice 0 */
		       <&main_pktdma 0x4101 0>, /* ingress slice 1 */
		       <&main_pktdma 0x4102 0>, /* mgmnt rsp slice 0 */
		       <&main_pktdma 0x4103 0>; /* mgmnt rsp slice 1 */
		dma-names = "tx0-0", "tx0-1", "tx0-2", "tx0-3",
			    "tx1-0", "tx1-1", "tx1-2", "tx1-3",
			    "rx0", "rx1";

		ethernet-ports {
			#address-cells = <1>;
			#size-cells = <0>;
			icssg0_emac0: port@0 {
				reg = <0>;
				phy-handle = <&icssg0_phy1>;
				phy-mode = "rgmii-id";
				syscon-rgmii-delay = <&main_conf 0x4100>;
				/* Filled in by bootloader */
				local-mac-address = [00 00 00 00 00 00];
			};

			icssg0_emac1: port@1 {
				reg = <1>;
				phy-handle = <&icssg0_phy2>;
				phy-mode = "rgmii-id";
				syscon-rgmii-delay = <&main_conf 0x4104>;
				/* Filled in by bootloader */
				local-mac-address = [00 00 00 00 00 00];
			};
		};

		r5f_shared {
			compatible = "vendor,device";
			memory-region = <&main_verivolt_buffering_dma_memory_region>;
		};
	};

	leds {
		compatible = "gpio-leds";
		pinctrl-names = "default";
		pinctrl-0 = <&leds_pins_default &user_leds_pins_default>;

		rgb-g {
			label = "RGB:Green:Heartbeat";
			gpios = <&main_gpio0 26 GPIO_ACTIVE_HIGH>;
			default-state = "off";
			linux,default-trigger = "heartbeat";
			function = LED_FUNCTION_HEARTBEAT;
		};

		rgb-r {
			label = "RGB:Red";
			gpios = <&main_gpio0 30 GPIO_ACTIVE_HIGH>;
			default-state = "off";
			linux,default-trigger = "mmc0";
			function = LED_FUNCTION_DISK;
			// linux,default-trigger = "cpu";
			// function = LED_FUNCTION_CPU;
		};

		rgb-b {
			label = "RGB:Blue";
			gpios = <&main_gpio0 22 GPIO_ACTIVE_HIGH>;
			default-state = "off";
			linux,default-trigger = "mmc1";
			function = LED_FUNCTION_DISK;
		};

		rgb-w {
			label = "RGB:White";
			gpios = <&main_gpio0 29 GPIO_ACTIVE_HIGH>;
			default-state = "off";
		};
	};

	pcie_refclk0: pcie-refclk0 {
		status = "okay";
		compatible = "gpio-gate-clock";
		pinctrl-names = "default";
		pinctrl-0 = <&pcie_usb_sel_pins_default>;
		clocks = <&serdes_refclk>;
		#clock-cells = <0>;
		enable-gpios =  <&main_gpio1 7 GPIO_ACTIVE_HIGH>;
	};

	vcc_3v3_mmc: regulator-sd {
		/* TPS22963C */
		compatible = "regulator-fixed";
		regulator-name = "VCC_3V3_MMC";
		regulator-min-microvolt = <3300000>;
		regulator-max-microvolt = <3300000>;
		regulator-boot-on;
		regulator-always-on;
	};

	fan: gpio-fan {
		compatible = "gpio-fan";
		gpio-fan,speed-map = <0 0 8600 1>;
		gpios = <&main_gpio0 28 GPIO_ACTIVE_LOW>;
		#cooling-cells = <2>;
		pinctrl-names = "default";
		pinctrl-0 = <&pinctrl_gpio_fan>;
		status = "okay";
	};

	// pwmfan0: pwm-fan {
	// 	compatible = "pwm-fan";
	// 	pinctrl-names = "default";
	// 	pinctrl-0 = <&pinctrl_gpio_fan>;
	// 	cooling-levels = <255 200 150 90 50 1>;   // PWM reversed so, cooling levels must be reversed
	// 	pwms = <&epwm3 0 6666666 0>; 
	// 	#cooling-cells = <2>;
	// 	status = "okay";
	// };

	wlan_en: regulator-1 {
		compatible = "regulator-fixed";
		regulator-name = "wlan_en";
		regulator-min-microvolt = <3300000>;
		regulator-max-microvolt = <3300000>;
		enable-active-high;
		gpios = <&main_gpio0 40 GPIO_ACTIVE_HIGH>;
		pinctrl-names = "default";
		pinctrl-0 = <&wlan_en_pins_default>;
	};
};

&main_pmx0 {
	pinctrl-names = "default";
	pinctrl-0 = <&user_gpio_connector>;

	can_tc1_pins_default: can-tc1-pins-default {
		pinctrl-single,pins = <
			AM64X_IOPAD(0x0084, PIN_OUTPUT, 7)	/* (P16) GPMC0_ADVn_ALE.GPIO0_32 */
		>;
	};

	can_tc2_pins_default: can-tc2-pins-default {
		pinctrl-single,pins = <
			AM64X_IOPAD(0x0090, PIN_OUTPUT, 7)	/* (P17) GPMC0_BE0n_CLE.GPIO0_35 */
		>;
	};

	clkout0_pins_default: clkout0-pins-default {
		pinctrl-single,pins = <
			AM64X_IOPAD(0x0274, PIN_OUTPUT, 5)	/* (A19) EXT_REFCLK1.CLKOUT0 */
		>;
	};

	icssg0_mdio_pins_default: icssg0-mdio-pins-default {
		pinctrl-single,pins = <
			AM64X_IOPAD(0x0200, PIN_INPUT, 0)	/* (P2) PRG0_MDIO0_MDIO */
			AM64X_IOPAD(0x0204, PIN_OUTPUT, 0)	/* (P3) PRG0_MDIO0_MDC */
			AM64X_IOPAD(0x01A8, PIN_OUTPUT, 7)	/* (V1) PRG0_PRU0_GPO18.GPIO1_18 */
			AM64X_IOPAD(0x01AC, PIN_OUTPUT, 7)	/* (W1) PRG0_PRU0_GPO19.GPIO1_19 */
		>;
	};

	icssg0_rgmii1_pins_default: icssg0-rgmii1-pins-default {
		pinctrl-single,pins = <
			AM64X_IOPAD(0x0160, PIN_INPUT, 2)	/* (Y1) PRG0_PRU0_GPO0.PRG0_RGMII1_RD0 */
			AM64X_IOPAD(0x0164, PIN_INPUT, 2)	/* (R4) PRG0_PRU0_GPO1.PRG0_RGMII1_RD1 */
			AM64X_IOPAD(0x0168, PIN_INPUT, 2)	/* (U2) PRG0_PRU0_GPO2.PRG0_RGMII1_RD2 */
			AM64X_IOPAD(0x016c, PIN_INPUT, 2)	/* (V2) PRG0_PRU0_GPO3.PRG0_RGMII1_RD3 */
			AM64X_IOPAD(0x0170, PIN_INPUT, 2)	/* (AA2) PRG0_PRU0_GPO4.PRG0_RGMII1_RX_CTL */
			AM64X_IOPAD(0x0178, PIN_INPUT, 2)	/* (T3) PRG0_PRU0_GPO6.PRG0_RGMII1_RXC */
			AM64X_IOPAD(0x018c, PIN_OUTPUT, 2)	/* (Y3) PRG0_PRU0_GPO11.PRG0_RGMII1_TD0 */
			AM64X_IOPAD(0x0190, PIN_OUTPUT, 2)	/* (AA3) PRG0_PRU0_GPO12.PRG0_RGMII1_TD1 */
			AM64X_IOPAD(0x0194, PIN_OUTPUT, 2)	/* (R6) PRG0_PRU0_GPO13.PRG0_RGMII1_TD2 */
			AM64X_IOPAD(0x0198, PIN_OUTPUT, 2)	/* (V4) PRG0_PRU0_GPO14.PRG0_RGMII1_TD3 */
			AM64X_IOPAD(0x019c, PIN_OUTPUT, 2)	/* (T5) PRG0_PRU0_GPO15.PRG0_RGMII1_TX_CTL */
			AM64X_IOPAD(0x01a0, PIN_OUTPUT, 2)	/* (U4) PRG0_PRU0_GPO16.PRG0_RGMII1_TXC */
		>;
	};

	icssg0_rgmii2_pins_default: icssg0-rgmii2-pins-default {
		pinctrl-single,pins = <
			AM64X_IOPAD(0x01b0, PIN_INPUT, 2)	/* (Y2) PRG0_PRU1_GPO0.PRG0_RGMII2_RD0 */
			AM64X_IOPAD(0x01b4, PIN_INPUT, 2)	/* (W2) PRG0_PRU1_GPO1.PRG0_RGMII2_RD1 */
			AM64X_IOPAD(0x01b8, PIN_INPUT, 2)	/* (V3) PRG0_PRU1_GPO2.PRG0_RGMII2_RD2 */
			AM64X_IOPAD(0x01bc, PIN_INPUT, 2)	/* (T4) PRG0_PRU1_GPO3.PRG0_RGMII2_RD3 */
			AM64X_IOPAD(0x01c0, PIN_INPUT, 2)	/* (W3) PRG0_PRU1_GPO4.PRG0_RGMII2_RX_CTL */
			AM64X_IOPAD(0x01c8, PIN_INPUT, 2)	/* (R5) PRG0_PRU1_GPO6.PRG0_RGMII2_RXC */
			AM64X_IOPAD(0x01dc, PIN_OUTPUT, 2)	/* (W4) PRG0_PRU1_GPO11.PRG0_RGMII2_TD0 */
			AM64X_IOPAD(0x01e0, PIN_OUTPUT, 2)	/* (Y4) PRG0_PRU1_GPO12.PRG0_RGMII2_TD1 */
			AM64X_IOPAD(0x01e4, PIN_OUTPUT, 2)	/* (T6) PRG0_PRU1_GPO13.PRG0_RGMII2_TD2 */
			AM64X_IOPAD(0x01e8, PIN_OUTPUT, 2)	/* (U6) PRG0_PRU1_GPO14.PRG0_RGMII2_TD3 */
			AM64X_IOPAD(0x01ec, PIN_OUTPUT, 2)	/* (U5) PRG0_PRU1_GPO15.PRG0_RGMII2_TX_CTL */
			AM64X_IOPAD(0x01f0, PIN_OUTPUT, 2)	/* (AA4) PRG0_PRU1_GPO16.PRG0_RGMII2_TXC */
		>;
	};

	main_i2c0_pins_default: main-i2c0-pins-default {
		pinctrl-single,pins = <
			AM64X_IOPAD(0x0260, PIN_INPUT_PULLUP, 0)	/* (A18) I2C1_SCL */
			AM64X_IOPAD(0x0264, PIN_INPUT_PULLUP, 0)	/* (B18) I2C1_SDA */
		>;
	};
	
	main_i2c1_pins_default: main-i2c1-pins-default {
		pinctrl-single,pins = <
			AM64X_IOPAD(0x0268, PIN_INPUT, 0)	/* (C18) I2C1_SCL */
			AM64X_IOPAD(0x026c, PIN_INPUT, 0)	/* (B19) I2C1_SDA */
		>;
	};

	main_i2c2_pins_default: main-i2c2-pins-default {
		pinctrl-single,pins = <
			AM64X_IOPAD(0x00B0, PIN_INPUT, 1)	// (P19) I2C2_SCL 
			AM64X_IOPAD(0x00B4, PIN_INPUT, 1)	// (R21) I2C2_SDA 
		>;
	};


	main_mcan0_pins_default: main-mcan0-pins-default {
		pinctrl-single,pins = <
			AM64X_IOPAD(0x0250, PIN_OUTPUT, 0)	/* (A17) MCAN0_TX */
			AM64X_IOPAD(0x0254, PIN_INPUT, 0)	/* (B17) MCAN0_RX */
		>;
	};

	main_mcan1_pins_default: main-mcan1-pins-default {
		pinctrl-single,pins = <
			AM64X_IOPAD(0x0258, PIN_OUTPUT, 0)	/* (C17) MCAN1_TX */
			AM64X_IOPAD(0x025c, PIN_INPUT, 0)	/* (D17) MCAN1_RX */
		>;
	};

	main_mmc1_pins_default: main-mmc1-pins-default {
		pinctrl-single,pins = <
			AM64X_IOPAD(0x027c, PIN_INPUT_PULLUP, 0)	/* (K18) MMC1_DAT3 */
			AM64X_IOPAD(0x0280, PIN_INPUT_PULLUP, 0)	/* (K19) MMC1_DAT2 */
			AM64X_IOPAD(0x0284, PIN_INPUT_PULLUP, 0)	/* (L21) MMC1_DAT1 */
			AM64X_IOPAD(0x0288, PIN_INPUT_PULLUP, 0)	/* (K21) MMC1_DAT0 */
			AM64X_IOPAD(0x028c, PIN_INPUT_PULLDOWN, 0)	/* (L20) MMC1_CLK */
			AM64X_IOPAD(0x0290, PIN_INPUT, 0)		/* MMC1_CLKLB */
			AM64X_IOPAD(0x0294, PIN_INPUT_PULLUP, 0)	/* (J19) MMC1_CMD */
			AM64X_IOPAD(0x0298, PIN_INPUT_PULLUP, 0)	/* (D19) MMC1_SDCD */
		>;
	};

	main_spi0_pins_default: main-spi0-pins-default {
		pinctrl-single,pins = <
			AM64X_IOPAD(0x020c, PIN_OUTPUT, 7)	/* (C13) SPI0_CS1.GPIO1_43 */
			AM64X_IOPAD(0x0210, PIN_INPUT, 0)	/* (D13) SPI0_CLK */
			AM64X_IOPAD(0x0214, PIN_OUTPUT, 0)	/* (A13) SPI0_D0 */
			AM64X_IOPAD(0x0218, PIN_INPUT, 0)	/* (A14) SPI0_D1 */
		>;
	};

	main_uart0_pins_default: main-uart0-pins-default {
		pinctrl-single,pins = <
			AM64X_IOPAD(0x0230, PIN_INPUT, 0)	/* (D15) UART0_RXD */
			AM64X_IOPAD(0x0234, PIN_OUTPUT, 0)	/* (C16) UART0_TXD */
		>;
	};

	main_uart1_pins_default: main-uart1-pins-default {
		pinctrl-single,pins = <
			AM64X_IOPAD(0x0248, PIN_INPUT, 0)	/* (D16) UART1_CTSn */
			AM64X_IOPAD(0x024C, PIN_OUTPUT, 0)	/* (E16) UART1_RTSn */
			AM64X_IOPAD(0x0240, PIN_INPUT, 0)	/* (E15) UART1_RXD */
			AM64X_IOPAD(0x0244, PIN_OUTPUT, 0)	/* (E14) UART1_TXD */
		>;
	};

	main_usb0_pins_default: main-usb0-pins-default {
		pinctrl-single,pins = <
			AM64X_IOPAD(0x02a8, PIN_OUTPUT, 0)	/* (E19) USB0_DRVVBUS */
		>;
	};

	pcie_usb_sel_pins_default: pcie-usb-sel-pins-default {
		pinctrl-single,pins = <
			AM64X_IOPAD(0x017c, PIN_OUTPUT, 7)	/* (T1) PRG0_PRU0_GPO7.GPIO1_7 */
		>;
	};

	pcie0_pins_default: pcie0-pins-default {
		pinctrl-single,pins = <
			AM64X_IOPAD(0x0098, PIN_OUTPUT, 7)	/* (W19) GPMC0_WAIT0.GPIO0_37 */
		>;
	};

	user_leds_pins_default: user-leds-pins-default {
		pinctrl-single,pins = <
			AM64X_IOPAD(0x0058, PIN_OUTPUT, 7)	/* (V21) GPMC0_AD7/BM_7/GPIO0_22/LED_STATUS_BLUE */
			AM64X_IOPAD(0x0068, PIN_OUTPUT, 7)	/* (W20) GPMC0_AD11/BM_11/GPIO0_26/LED_STATUS_GREEN */
			AM64X_IOPAD(0x0074, PIN_OUTPUT, 7)	/* (Y21) GPMC0_AD14/BM_14/GPIO0_29/LED_STATUS_WHITE */
			AM64X_IOPAD(0x0078, PIN_OUTPUT, 7)	/* (Y20) GPMC0_AD15/BM_15/GPIO0_30/LED_STATUS_RED */
		>;
	};

	main_spi1_pins_default: main-spi1-pins-default {
		pinctrl-single,pins = <
			AM64X_IOPAD(0x0224, PIN_INPUT , 0)	/* (C14) SPI1_CLK  GPIO1_49  */
			AM64X_IOPAD(0x021C, PIN_OUTPUT, 0)	/* (D14) SPI1_CS0  GPIO1_47  */ 
			AM64X_IOPAD(0x0220, PIN_OUTPUT, 0)	/* (D14) SPI1_CS1  GPIO1_48  */
			AM64X_IOPAD(0x0228, PIN_OUTPUT, 0)	/* (B15) SPI1_D0   GPIO1_50  */
			AM64X_IOPAD(0x022C, PIN_INPUT , 0)	/* (A15) SPI1_D1   GPIO1_51  */
		>;
	};

	gc9a01_pins: gc9a01-pins {
		pinctrl-single,pins = <
			AM64X_IOPAD(0x0050, PIN_INPUT, 7) /* (U19)  GPMC0_AD5/BM_5/GPIO0_83/RST_LCD */
			AM64X_IOPAD(0x0060, PIN_INPUT, 7) /* (T17)  GPMC0_AD9/BM_9/GPIO0_24/DC_LCD */
		>;
	};

	touch_screen_pins_default: touch-screen-pins-default {
		pinctrl-single,pins = <
		   AM64X_IOPAD(0x007C, PIN_INPUT, 7) /* (R17) GPMC0_CLK/GPIO0_31/IRQ_TS_LCD */
		   AM64X_IOPAD(0x004C, PIN_OUTPUT, 7) /* (R16) GPMC0_AD4/BM_4/GPIO0_82/RST_TS_LCD */
		>;
	};

	user_gpio_connector: user-gpio-connector {
		pinctrl-single,pins = <
			AM64X_IOPAD(0x0A8, PIN_OUTPUT, 7) /* (R19) GPIO0_41/GPIO_CN2_0 */
			AM64X_IOPAD(0x088, PIN_OUTPUT, 7) /* (R18) GPIO0_33/GPIO_CN2_1 */
			AM64X_IOPAD(0x094, PIN_INPUT, 7)  /* (T19) GPIO0_36/GPIO_CN2_2 */
			AM64X_IOPAD(0x0AC, PIN_INPUT, 7)  /* (R20) GPIO0_42/GPIO_CN2_3 */
			AM64X_IOPAD(0x23C, PIN_INPUT | INPUT_EN, 7) /* (A16) GPIO1_55/UART0_RTS/FR_BTN */
			// TODO: GPIO1_54/INT_BTN
			AM64X_IOPAD(0x270, PIN_INPUT | INPUT_EN, 7) /* (D18) GPIO1_68/EXT_BTN */
		>;
	};

	pinctrl_gpio_fan: pinctrl-gpio-fan {
		pinctrl-single,pins = <
			AM64X_IOPAD(0x070, PIN_OUTPUT, 7) /* (V18) GPMC0_AD13.GPIO0_28 */
			// AM64X_IOPAD(0x070, PIN_OUTPUT, 3) /* (V18) GPMC0_AD13.GPIO0_28, 9 = PWM3_A0, 3 = EHRPWM3_A */
		>;
	};

	wlan_en_pins_default: wlan-en-pins-default {
		pinctrl-single,pins = <
			AM64X_IOPAD(0x0A4, PIN_OUTPUT, 7) /* (N17) GPIO0_40*/
		>;
	};

};

&icssg0_mdio {
	status = "okay";
	pinctrl-names = "default";
	pinctrl-0 = <&icssg0_mdio_pins_default &clkout0_pins_default>;

	icssg0_phy1: ethernet-phy@1 {
		compatible = "ethernet-phy-id2000.a231", "ethernet-phy-ieee802.3-c22";
		reg = <0x1>;
		ti,rx-internal-delay = <DP83867_RGMIIDCTL_2_00_NS>;
		tx-fifo-depth = <DP83867_PHYCR_FIFO_DEPTH_4_B_NIB>;
		rx-fifo-depth = <DP83867_PHYCR_FIFO_DEPTH_4_B_NIB>;
		ti,led-0-active-low;
		ti,led-2-active-low;

		reset-gpios = <&main_gpio1 18 GPIO_ACTIVE_LOW>;
		reset-assert-us = <1000>;
		reset-deassert-us = <1000>;
	};

	icssg0_phy2: ethernet-phy@2 {
		compatible = "ethernet-phy-id2000.a231", "ethernet-phy-ieee802.3-c22";
		reg = <0x2>;
		ti,rx-internal-delay = <DP83867_RGMIIDCTL_2_00_NS>;
		tx-fifo-depth = <DP83867_PHYCR_FIFO_DEPTH_4_B_NIB>;
		rx-fifo-depth = <DP83867_PHYCR_FIFO_DEPTH_4_B_NIB>;
		ti,led-0-active-low;
		ti,led-2-active-low;

		reset-gpios = <&main_gpio1 19 GPIO_ACTIVE_LOW>;
		reset-assert-us = <1000>;
		reset-deassert-us = <1000>;
	};
};

&main_i2c0 {
	status = "okay";
	pinctrl-names = "default";
	pinctrl-0 = <&main_i2c0_pins_default>;
	clock-frequency = <400000>;
};


// &epwm3{
// 	status = "okay";
// };


&main_i2c1 {
	status = "okay";
	pinctrl-names = "default";
	pinctrl-0 = <&main_i2c1_pins_default>;
	clock-frequency = <400000>;

	gt911: touchscreen@5d {
		compatible = "goodix,gt911";
		reg = <0x5d>;

		pinctrl-names = "default";
		pinctrl-0 = <&touch_screen_pins_default>;

		interrupt-parent = <&main_gpio0>;
		interrupts = <31 IRQ_TYPE_EDGE_RISING>;
		reset-gpios = <&main_gpio0 82 GPIO_ACTIVE_HIGH>;
		irq-gpios   = <&main_gpio0 31 GPIO_ACTIVE_HIGH>;

		touchscreen-inverted-x;
		touchscreen-inverted-y;
		touchscreen-swapped-x-y;
	};

	eeprom@51 {
		compatible = "atmel,24c02";
		pagesize = <16>;
		reg = <0x51>;
	};
};

&main_i2c2 {
	status = "okay";
	pinctrl-names = "default";
	pinctrl-0 = <&main_i2c2_pins_default>;
	clock-frequency = <400000>;
};

&i2c_som_rtc {
	enable-level-switching-mode;
};

&main_mcan0 {
	status = "okay";
	pinctrl-names = "default";
	pinctrl-0 = <&main_mcan0_pins_default>;
	phys = <&can_tc1>;
};

&main_mcan1 {
	status = "okay";
	pinctrl-names = "default";
	pinctrl-0 = <&main_mcan1_pins_default>;
	phys = <&can_tc2>;
};

&main_spi0 {
	status = "okay";
	pinctrl-names = "default";
	pinctrl-0 = <&main_spi0_pins_default>;
	cs-gpios = <0>, <&main_gpio1 43 GPIO_ACTIVE_LOW>;
	ti,pindir-d0-out-d1-in = <1>;

	tpm20@1 {
		compatible = "infineon,slb9670";
		reg = <1>;
		spi-max-frequency = <10000000>;
	};
};

&main_uart0 {
	status = "okay";
	pinctrl-names = "default";
	pinctrl-0 = <&main_uart0_pins_default>;
};

&main_uart1 {
	status = "okay";
	pinctrl-names = "default";
	pinctrl-0 = <&main_uart1_pins_default>;
	uart-has-rtscts;
};

&pcie0_ep {
	status = "okay";
	phys = <&serdes0_pcie_usb_link>;
	phy-names = "pcie-phy";
	num-lanes = <1>;
};

&pcie0_rc {
	status = "okay";
	pinctrl-names = "default";
	pinctrl-0 = <&pcie0_pins_default>;
	reset-gpios = <&main_gpio0 37 GPIO_ACTIVE_HIGH>;
	phys = <&serdes0_pcie_usb_link>;
	phy-names = "pcie-phy";
	num-lanes = <1>;
};

&sdhci1 {
	// vmmc-supply = <&vcc_3v3_mmc>;
	vmmc-supply = <&wlan_en>;
	pinctrl-names = "default";
	pinctrl-0 = <&main_mmc1_pins_default>;
	bus-width = <4>;
	ti,driver-strength-ohm = <50>;
	disable-wp;
	no-1-8-v;
};

&serdes0 {
	assigned-clock-parents = <&pcie_refclk0>, <&pcie_refclk0>, <&pcie_refclk0>;
	
	serdes0_pcie_usb_link: phy@0 {
		reg = <0>;
		cdns,num-lanes = <1>;
		#phy-cells = <0>;
		cdns,phy-type = <PHY_TYPE_USB3>;
		resets = <&serdes_wiz0 1>;
	};
};

&serdes_ln_ctrl {
	idle-states = <AM64_SERDES0_LANE0_PCIE0>;
};

&usbss0 {
	ti,usb2-only;
};

&usb0 {
	dr_mode = "host";
	maximum-speed = "high-speed";
	pinctrl-names = "default";
	pinctrl-0 = <&main_usb0_pins_default>;
	phys = <&serdes0_pcie_usb_link>;
	phy-names = "cdns3,usb3-phy";
};

&main_spi1 {
	status = "okay";
	pinctrl-names = "default";
	pinctrl-0 = <&main_spi1_pins_default>;
	ti,pindir-d0-out-d1-in = <1>;
	ti,spi-num-cs = <2>;
	#address-cells = <1>;
	#size-cells    = <0>;

	gc9a01: gc9a01@1 {
		compatible = "sitronix,st7789v";
		reg = <1>;
		pinctrl-names = "default";
		pinctrl-0     = <&gc9a01_pins>;
		dc-gpios    = <&main_gpio0 24 GPIO_ACTIVE_HIGH>; //INVERTED
		reset-gpios = <&main_gpio0 83 GPIO_ACTIVE_LOW>;  //INVERTED
		spi-max-frequency = <32000000>;
		buswidth = <8>;
		txbuflen = <32768>;
		width    = <240>;
		height   = <320>;
		rotate   = <90>;
		spi-cpol;
		spi-cpha;
		debug = <0x4000000>;
	};

	spidev@0 {
		spi-max-frequency = <24000000>;
		reg = <0>;
		compatible = "rohm,dh2228fv";
	};
};

&reserved_memory {
	main_verivolt_buffering_dma_memory_region: r5f-dma-memory@a5800000 {
		compatible = "shared-dma-pool";
		reg = <0x0 0xa5800000 0x0 0x4000000>;
		no-map;
	};
};

&serdes0_pcie_usb_link {
	cdns,phy-type = <PHY_TYPE_PCIE>;
};

&serdes_refclk {
	clock-frequency = <100000000>;
};

/*
 * Assign pcie_refclk0 to serdes_wiz0 as ext_ref_clk.
 * This makes sure that the clock generator gets enabled at the right time.
 */
&serdes_wiz0 {
	clocks = <&k3_clks 162 0>, <&k3_clks 162 1>, <&pcie_refclk0>;
};

&thermal_zones {
	main0_thermal: main0-thermal {
		trips {
			main0_thermal_trip0: main0-thermal-trip {
				temperature = <70000>;  /* millicelsius */
				hysteresis = <5000>;    /* millicelsius */
				type = "active";
			};
		};

		cooling-maps {
			map0 {
				trip = <&main0_thermal_trip0>;
				cooling-device = <&fan THERMAL_NO_LIMIT THERMAL_NO_LIMIT>;
			};
		};
	};
};
